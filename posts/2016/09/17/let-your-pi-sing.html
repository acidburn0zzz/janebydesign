<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" sizes="57x57" href="../../../../img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../../../../img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../../../../img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../../../img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../../../../img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../../../../img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../../../../img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../../../../img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../../../img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../../../../android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../../../img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="../../../../img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../../../../img/favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" href="../../../../img/favicon/favicon.ico">
    <title>Blurbs</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/blog/css/app.min.css"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400|Poppins:400">
  </head>
  <body>
    <!-- CONTENT -->
    <div class="blog container-fluid">
      <div class="row">
        <div class="nav-brand">
          <a href="/"><img class="shadow" src="/blog/img/logo2.png"></a>
        </div>
        <div class="mobile-nav-panel">
          <i class="fa fa-bars" aria-hidden="true"></i>
        </div>
        <nav class="back-blog-home col-xs-12 col-md-10 col-md-offset-1" role="navigation">
          <ul>
            <li class="rtl-transition"><a href="/blog/"><i class="fa fa-long-arrow-left" aria-hidden="true"></i> back to blog home</a></li>
          </ul>
        </nav>

        <div class="post-body col-xs-12 col-md-10 col-md-offset-1">
          <h2 class="blog-title">let your pi sing</h2>
          <div class="meta author-date">
            
              <date>17 september 2016</date>
              <span class="bullet">&nbsp;¬∑&nbsp;</span>
            
            <author>Jane</author>
          </div>
          <p class="blog-body"><p><p class="short-summary">A guide to creating an Airplay receiver with the Pi, so anyone with an iOS device or computer with iTunes installed can play you some sweet tunes.</p>
<!--more--></p>
<p>Do you love music, convenience, and not having to put down your smartphone? If you&#39;re technically apt as well, then here&#39;s a little DIY to turn your Raspberry Pi into an Airplay receiver. You can hook it up to your favourite speaker and let the good times begin! As for myself, I&#39;ve got mine plugged into the <a href="http://worldwide.bose.com/productsupport/en_us/web/solo_10_series_ii/page.html">Bose 10 Series II</a> sound system -- it&#39;s üíé.</p>
<p>I know, if you Google how to make one of these, basically everyone and their mother have at some point written a tutorial -- so begs the question, why am I creating another one? Well, I&#39;ve found that I&#39;ve had to use several different sources to make the one work. Thus, I should share an updated tutorial. I know, I know, I&#39;m so kind. üòÇ Alright, so let&#39;s get to the good stuff!</p>
<h3 id="things-you-need">Things You Need</h3>
<ul>
<li>‚Ä¢ A configured <a href="../15/piece-of-raspberry-pi.html">Raspberry Pi</a></li></li>
<li>‚Ä¢ 3.5mm stereo audio cable (this is so you can connect the Pi to your stereo)</li></li>
<li>‚Ä¢ Stereo/Speakers</li></li>
<li>‚Ä¢ iOS device or computer with iTunes installed</li></li>
</ul>
<h3 id="airplay-for-your-earholes">Airplay For Your Earholes</h3>
<p>Finally, what you&#39;ve been waiting for!</p>
<h4 id="configure-the-audio-port">Configure The Audio Port</h4>
<p>By default, the Pi&#39;s audio comes from the HDMI port. So unless you plan to have it plugged into a TV or somethang, you&#39;ll want the audio to come from the mini audio jack -- this way, you can hook it up to yo badass sound system üîä</p>
<p>Alright then. Run the following command:</p>
<pre><code>  sudo amixer cset numid=3 1
</code></pre><p>When you do this, you should see the following output:</p>
<center><img src="../../../../img/screenshots/rpi_amixer.png" alt="analog output activated"></center>

<p>What <code>amixer</code> does is allow you to modify the sound card&#39;s options. What we did with that command was set the 3rd soundcard element to 1. This triggers the analog output.</p>
<h4 id="some-installation-required">Some Installation Required</h4>
<p>There are some pre-reqs to install. This is for something called <a href="http://arstechnica.com/apple/2011/04/shairport-emulates-airport-express-to-receive-airplay-streams/">Shairport</a>, which basically allows you to do what AirPort express does. This is what&#39;s going to allow your iOS device (iPhone, iPad, etc) to send music via Airplay to your Raspberry Pi so it plays through your speakers.</p>
<p>So paste the following into your terminal and run it (it&#39;ll eventually ask you if you&#39;re sure you want to proceed; when it does type <code>Y</code> and hit <code>enter</code>):</p>
<pre><code>  sudo apt-get install git libao-dev libssl-dev libcrypt-openssl-rsa-perl libio-socket-inet6-perl libwww-perl avahi-utils libmodule-build-perl
</code></pre><p>It should look like this:</p>
<center><img src="../../../../img/screenshots/rpi_shairport_pre.png" alt="shairport pre-reqs"></center>

<p>Basically, this is showing you what it&#39;s going to install -- the libraries you specified and their pre-requisites, if any.</p>
<p>Does the command look kind of familiar? That&#39;s because it&#39;s like the command we ran earlier to update the Pi.<br />
<code>sudo</code> says, &quot;Run the command as an admin, yo!&quot;<br />
<code>apt-get</code> as you remember, is the package manager.<br />
<code>install</code> is the command telling <code>apt-get</code> what to do; in this case it&#39;s to install what follows.
<code>git libao-dev libssl-dev libcrypt-openssl-rsa-perl libio-socket-inet6-perl libwww-perl avahi-utils libmodule-build-perl</code> are the libraries we&#39;re installing. </p>
<h4 id="it-s-just-protocol">It&#39;s Just Protocol</h4>
<p>The next thing we need is Perl Net-SDP. This is going to allow the Pi to communicate with Airplay using the <a href="https://en.wikipedia.org/wiki/Session_Description_Protocol">SDP Protocol</a>, which Airplay has been using since iOS 6 (we&#39;re on 10 now). </p>
<p>So let&#39;s do this. Just a friendly reminder, you should still be doing all these commands in your Pi SSH session! </p>
<pre><code>  git clone https://github.com/njh/perl-net-sdp.git perl-net-sdp
</code></pre><p>This is why we installed git previously. In this step, we&#39;re cloning a copy of this repo onto the Pi. You should see the following output:</p>
<center><img src="../../../../img/screenshots/rpi_perl_sdp.png" alt="perl SDP protocol"></center>

<p>Now we want to compile and install the Perl Net-SDP components into their proper places. Run the commands below, one at a time! </p>
<pre><code>  cd perl-net-sdp
  perl Build.PL
  sudo ./Build
  sudo ./Build test
  sudo ./Build install
  cd ..
</code></pre><p>Note, if you get any warning messages that look like the following, it&#39;s just about setting your locale and it won&#39;t interfere with any of your commands working properly:</p>
<center><img src="../../../../img/screenshots/rpi_locale_warn.png" alt="locale warning"></center>

<p>Don&#39;t even trip, dawg.</p>
<h4 id="set-to-receive">Set To Receive</h4>
<p>We&#39;re at that point where we&#39;re actually going to set up the receiver, huzzah! Congratulations for bearing with me and getting this far. </p>
<p>Okay, so the following commands you&#39;ll run them one at a time, but of course.</p>
<pre><code>  git clone https://github.com/hendrikw82/shairport.git
  cd shairport
  make
</code></pre><p>So what do these do?<br />
The first makes a clone of the Shairport repository on the Pi.<br />
The second, you&#39;re just changing directories into the repo you just cloned.<br />
The third, you&#39;re building the software.</p>
<p>Cool! You should see something like this:</p>
<center><img src="../../../../img/screenshots/rpi_shairport.png" alt="install shairport"></center>

<p>With all that hard work, now you get to start the Shairport script and <u>name your receiver</u>. Basically, this is the alias you&#39;ll see on your iOS device. Choose wisely, friends.</p>
<pre><code>  ./shairport.pl -a RECEIVER_NAME
</code></pre><p>Replace <code>RECEIVER_NAME</code> with the name you want to give your receiver.<br />
For mine, I did <code>./shairport.pl -a AirPi</code>.<br />
The <code>-a</code> command is saying &quot;Hey, name my receiver whatever word comes after me.&quot;</p>
<p>So if you see something like the following, you&#39;re üëå</p>
<center><img src="../../../../img/screenshots/rpi_shairport_run.png" alt="shairport running"></center>

<p>Notice the <code>@AirPi</code> -- it should show the receiver name you&#39;ve provided. </p>
<p>Let&#39;s discover the spoils of your labour! üéâ</p>
<h4 id="a-little-note-on-ios-10">A Little Note On iOS 10</h4>
<p>Before we really check things out to see if everything&#39;s gone smoothly, I want to make a note for the non-savages who&#39;ve upgraded to iOS 10 üòú I promise this is relevant. </p>
<p>It seems our friends at Apple are hard at work making sure we buy more of their products. If you look at your control center (you know, that thing that slides up) you&#39;ll see that there&#39;s only the default option for &quot;AirPlay Mirroring&quot; and it&#39;ll only work if you have an Apple TV. Before iOS 10, you would be able to select devices that were AirPlay-AirPort express compatible -- to do this now, you&#39;ll have to <code>swipe left</code> to get to the screen you want. Let me show you what I mean:</p>
<center>
  <img src="../../../../img/screenshots/ctrl_center_default.png" alt="airplay mirroring">
  <img src="../../../../img/screenshots/ctrl_center_music.png" alt="swipe left">
</center>

<p>The left shows the default &quot;AirPlay Mirroring&quot; and the right is what shows when you swipe left. That second screen is where you&#39;ll see what song you&#39;re playing (if you are), whether it&#39;s from the Apple Music app or Spotify, or what have you. Here&#39;s an image of what the control center looks like now when you&#39;re playing music and you&#39;ve selected to stream it to your Pi (hint: it&#39;s always going to be on the 2nd page of the control center):</p>
<center><img src="../../../../img/screenshots/ctrl_center_spotify.png" alt="spotify control center"></center>

<p>You&#39;ll also be able to select your Pi from the music apps themselves! Take a gander:</p>
<center>
  <img src="../../../../img/screenshots/ios_music_airplay.png" alt="music">
  <img src="../../../../img/screenshots/rpi_spotify.png" alt="spotify">
</center>

<h4 id="check-it-out-">Check It Out!</h4>
<p>The moment of truth folks. Whip out your iOS device, open up a music player, and see if your Pi is an available device! It&#39;s also important to note that you should make sure the Pi and your device are on the same wireless network, or it won&#39;t work. </p>
<p>Did it work? Yes? Fantastic!<br />
‚ù§Ô∏è</p>
<p>As cool as it is, it would be kind of annoying if you had to SSH into the Pi and run that Shairport command from above everytime you wanted to use this, right? Hell yea. So let&#39;s fix that and make sure Shairpoint is running in the background of the Pi at all times and starts up at startup if you ever have to reboot the Pi. </p>
<h4 id="the-friendly-daemon">The Friendly Daemon</h4>
<p>We&#39;re going to &quot;Daemon-ize&quot; Shairport, and no, I don&#39;t mean what left- and right-wing political groups do to each other. If you&#39;re not familiar with <a href="https://en.wikipedia.org/wiki/Daemon_(computing">daemons</a>), they&#39;re computer programmes which run in the background and don&#39;t require a user to be explicitly controlling them. With that being said, we&#39;re going to make Shairport a daemon.</p>
<p>üòà</p>
<p>Check: make sure you&#39;re SSH&#39;d into the Pi!<br />
It can sometimes time out if you&#39;re inactive for too long.<br />
Or hit <code>ctrl + c</code> to suspend Shairport if you&#39;re still running it from the last command.</p>
<p>Let&#39;s run the following, one at a time:</p>
<pre><code>  cd shairport
  sudo make install
  sudo cp shairport.init.sample /etc/init.d/shairport
</code></pre><p>These commands will take you to the shairport directory (if you&#39;re not already there -- because if you are, that first command doesn&#39;t apply to you), create the daemon directory, <code>make install</code>, and then copy a sample init file to the directory you just made. </p>
<center><img src="../../../../img/screenshots/rpi_sp_daemon_sample.png" alt="daemon directory"></center>

<p>The next set of commands are as follows:</p>
<pre><code>  cd /etc/init.d
  sudo chmod a+x shairport
  sudo update-rc.d shairport defaults
</code></pre><p>This is saying, &quot;hey, go into the daemon directory <code>/etc/init.d</code>, change its permissions <code>chmod a+x</code> and &quot;install&quot; what&#39;s instructed in the Shairport init file with the default options -- <code>defaults</code>.</p>
<center><img src="../../../../img/screenshots/rpi_install_sp_init.png" alt="install Shairport init"></center>

<p>Now run this command:</p>
<pre><code>  sudo vi shairport
</code></pre><p>This is going to open up the vi text editor in the terminal. Go down to what looks like this:</p>
<pre><code>  DAEMON_ARGS=&quot;-w $PIDFILE&quot;
</code></pre><center><img src="../../../../img/screenshots/rpi_vi_shairport_init.png" alt="daemon_args option set default name"></center>

<p>If you&#39;re not familiar with vim/vi, follow these steps to get to the line, type one line at a time:</p>
<pre><code>  /DAE [enter]
  n
  $
  i
  [space] -a RECEIVER_NAME
  [esc]
  :wq [enter]
</code></pre><p><code>/DAE [enter]</code> will take you to the first instance of &quot;DAE&quot;.<br />
<code>n</code> says, &quot;Go to the next instance of my search term DAE&quot;.<br />
<code>$</code>, or <code>shift + 4</code>, takes you to the end of the line.<br />
<code>i</code> will put you in &quot;insert mode&quot;, starting from behind the character you&#39;re on when going into this mode.<br />
<code>[space] -a RECEIVER_NAME</code> you&#39;re adding a default name to the DAEMON_ARGS option.<br />
<code>[esc]</code> will take you out of &quot;insert mode&quot;.<br />
<code>:wq [enter]</code> tells vi to &quot;write&quot; the file and &quot;quit&quot; out to the terminal.<br /></p>
<p>So now, your line should look something like this:</p>
<pre><code>  DAEMON_ARGS=&quot;-w $PIDFILE -a AirPi&quot;
</code></pre><center><img src="../../../../img/screenshots/rpi_vi_shairport.png" alt="daemon_args option set default name"></center>

<p>where <code>AirPi</code> is replaced with whatever you named the receiver. </p>
<p>V cool. What you&#39;re doing here is setting your default AirPlay receiver name. Now, anytime you boot up the Pi, this Shairport executable file will also start. </p>
<p>Remember, <code>RECEIVER_NAME</code> is what you were calling your AirPlay receiver. Mine was <code>AirPi</code>. </p>
<h3 id="-br-center-you-did-it-http-i-giphy-com-lgwovr7ygukrc-gif-center-"><br /><center><img src="http://i.giphy.com/LgwoVr7YgUkrC.gif" alt="you did it!"></center></h3>
<p>You&#39;ve done it! Pats on the back for finishing the AirPlay receiver project like a champ üëè</p>
<p>At this point, go ahead and stream something to the Pi and make sure everything&#39;s good to go! You may notice that the sound is a bit low. If that&#39;s the case read this next session on changing some settings for better audio output.</p>
<h3 id="volumise">Volumise</h3>
<p>Can&#39;t hear your tunes? Let&#39;s set the volume as a percentage (although it can also be a dB gain or exact hardware value, and if interested can read more about <a href="https://linux.die.net/man/1/amixer">here</a>) through amixer. <a href="https://linux.die.net/man/1/amixer">Amixer</a> is a command-line mixer for soundcard drivers in Linux-based systems, like your Pi. Your Pi has the ASLA soundcard driver. You remember amixer from before, right? üòâ</p>
<p>We know amixer is on the Pi because we&#39;ve used an amixer command before. But if you want to do a sanity check and make sure I&#39;m not lying to you, go back to your root level, <code>cd ~</code>, in the terminal, making sure you&#39;re SSH&#39;d into the Pi, and type this command:</p>
<pre><code>  which amixer
</code></pre><p>That should spit out the following:</p>
<center><img src="../../../../img/screenshots/rpi_amixer_check.png" alt="which amixer"></center>

<p>See that? Yes? Cool. </p>
<p>Now, stream your favourite song to your new AirPlay receiver so you can witness real-time sound checking as you set the volume percentage to your liking. If, for some reason, you don&#39;t see your Pi appearing as an AirPlay option, just reboot the Pi like so:</p>
<pre><code>  sudo shutdown -r now
</code></pre><p>Got a song going? Fab. Love. </p>
<p>Do the following command:</p>
<pre><code>  amixer sset PCM PERCENT%
</code></pre><p>Needless to say, you&#39;ll want to change <code>PERCENT</code> to a number, leaving the <code>%</code> there. You need the <code>%</code>. For me, I set mine to <code>90%</code>. I found going all the way up to 100% gives some not-too-favourable results. </p>
<center><img src="../../../../img/screenshots/rpi_set_vol.png" alt="set volume"></center>

<p>Play around with the percentage until you find a sweet spot for you. Once you&#39;ve done that, you&#39;ll want to save this setting lest you want to set this every time you start up the Pi. Blegh, who wants to do that, amiright? Let&#39;s save this badboy:</p>
<pre><code>  sudo alsactl store
</code></pre><p>This will store the volume setting. </p>
<p>Woo! You&#39;re done configuring your Pi for excellent AirPlay capabilities! Let the good times roll üéâ</p>
<p>Now, unless you want to keep the ethernet cable plugged into your Pi at all times, you&#39;ll want to get your Wi-Pi set up. So if you&#39;re going to be joining me in this part, go to the tutorial on <a href="../wifi-for-your-pi.html">setting up Wi-Fi</a>!</p>
</p>
          <br class="clear" />
          <div class="meta tags">
            
              <a class="tag" href="/blog/tags.html?tag=diy">#diy</a>
            
              <a class="tag" href="/blog/tags.html?tag=learning">#learning</a>
            
              <a class="tag" href="/blog/tags.html?tag=raspberrypi">#raspberrypi</a>
            
              <a class="tag" href="/blog/tags.html?tag=airplay">#airplay</a>
            
          </div>
          <br class="clear" />
          <div class="post-prev-post">
            <ul class="blog-post-nav">
              <li class="rtl-transition"><a href="#"><p><i class="fa fa-long-arrow-left" aria-hidden="true"></i> Previous Post</p></a></li>
              <li class="ltr-transition"><a href="#"><p>Next Post <i class="fa fa-long-arrow-right" aria-hidden="true"></i></p></a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- SEARCH / FOOTER  -->
    <div class="search"><a href="#" class="btn btn-circle" role="button"><i class="fa fa-search" aria-hidden="true"></i></a></div>
    <nav id="footer" class="nav-footer col-xs-12 col-md-10 col-md-offset-1 navbar-fixed-bottom">
      <ul>
        <li><a href="/">about</a></li>
        <li><a href="/blog/">blog</a></li>
        <li><a href="/resume/janelundgren.html">resume</a></li>
        <li><a href="https://www.github.com/spilledmilk">github</a></li>
        <li><a href="/portfolio.html">portfolio</a></li>
        <li><a href="http://500px.com/spilledmilk">photography</a></li>
      </ul>
    </nav>

    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <script src="/blog/js/app.min.js" type="text/javascript"></script>
  </body>
</html>
